<!DOCTYPE html>
<html lang="zh">
<head>
    <meta charset="UTF-8">
    <title>2000年至今的亚洲主要灾害可视化地图</title>
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <style>
        #map {
            height: 800px;
            width: 100%;
        }
        
        #yearStart, #yearEnd {
            width: 160px;
            margin: 0 5px;
        }
        #yearRangeDisplay {
            font-weight: bold;
        }


        .legend {
            margin-bottom: 14px;
            font-size: 16px;
        }

        .legend-item {
            display: inline-flex;
            align-items: center;
            margin-right: 24px;
        }

        .legend-shape {
            width: 24px;
            height: 24px;
            margin-right: 6px;
            display: inline-block;
        }

        .circle {
            border-radius: 50%;
            background-color: yellow;
            border: 2px solid black;
        }

        .square{
            background:blue;
            border: 2px solid black;
        }

        .hexagon {
            background: purple;
            clip-path: polygon(25% 0%, 75% 0%, 100% 50%, 75% 100%, 25% 100%, 0% 50%);
            border: 2px solid black;
        }

        .diamond {
            background: orange;
            transform: rotate(45deg);
            border: 2px solid black;
        }
    </style>
</head>
<body>
    <h1 style="margin-bottom:8px;">2000年至今的亚洲主要灾害可视化地图</h1>
    <div class="legend">
        <span class="legend-item">
            <span class="legend-shape circle"></span>地震
        </span>
        <span class="legend-item">
            <span class="legend-shape square"></span>洪水
        </span>
        <span class="legend-item">
            <span class="legend-shape hexagon"></span>火山运动
        </span>
        <span class="legend-item">
            <span class="legend-shape diamond"></span>风暴
        </span>
    </div>
    <label for="disasterType">选择灾害类型：</label>
    <select id="disasterType">
        <option value="全部">全部</option>
        <option value="地震">地震</option>
        <option value="洪水">洪水</option>
        <option value="火山运动">火山运动</option>
        <option value="风暴">风暴</option>
    </select>
    <label style="margin-left:24px;">选择年份区间：</label>
    <input type="range" id="yearStart" />
    <input type="range" id="yearEnd" />
    <span id="yearRangeDisplay"></span>


    <div id="map"></div>

    <script src="https://unpkg.com/leaflet/dist/leaflet.js"></script>
    <script>
        
        var data = [
            {
                "name": "地震",
                "latitude": 31.002,
                "longitude": 103.322,
                "start_date": "2008年5月12日",
                "end_date": "2008年5月12日",
                "affected": 45976596
            },
            {
                "name": "地震",
                "latitude": 38.055,
                "longitude": 36.51,
                "start_date": "2023年2月6日",
                "end_date": "2023年2月6日",
                "affected": 16107000
            },
            {
                "name": "地震",
                "latitude": 31.002,
                "longitude": 103.322,
                "start_date": "2008年5月12日",
                "end_date": "2008年5月12日",
                "affected": 45976596
            },
            {
                "name": "地震",
                "latitude": 38.055,
                "longitude": 36.51,
                "start_date": "2023年2月6日",
                "end_date": "2023年2月6日",
                "affected": 16107000
            },
            {
                "name": "地震",
                "latitude": 38.055,
                "longitude": 36.51,
                "start_date": "2023年2月6日",
                "end_date": "2023年2月6日",
                "affected": 8808700
            },
            {
                "name": "地震",
                "latitude": 23.419,
                "longitude": 70.232,
                "start_date": "2001年1月26日",
                "end_date": "2001年1月26日",
                "affected": 6321812
            },
            {
                "name": "地震",
                "latitude": 28.23,
                "longitude": 84.731,
                "start_date": "2015年4月25日",
                "end_date": "2015年4月25日",
                "affected": 5639722
            },
            {
                "name": "地震",
                "latitude": 34.539,
                "longitude": 73.588,
                "start_date": "2005年10月8日",
                "end_date": "2005年10月8日",
                "affected": 5128309
            },
            {
                "name": "地震",
                "latitude": 9.8796,
                "longitude": 124.1167,
                "start_date": "2013年10月15日",
                "end_date": "2013年10月15日",
                "affected": 3222224
            },
            {
                "name": "地震",
                "latitude": -7.961,
                "longitude": 110.446,
                "start_date": "2006年5月26日",
                "end_date": "2006年5月26日",
                "affected": 3177923
            },
            {
                "name": "地震",
                "latitude": -8.207,
                "longitude": 118.631,
                "start_date": "2009年9月30日",
                "end_date": "2009年9月30日",
                "affected": 2501798
            },
            {
                "name": "地震",
                "latitude": -6.853,
                "longitude": 107.095,
                "start_date": "2022年11月21日",
                "end_date": "2022年11月21日",
                "affected": 2204645
            },
            {
                "name": "地震",
                "latitude": 30.308,
                "longitude": 102.888,
                "start_date": "2013年4月20日",
                "end_date": "2013年4月20日",
                "affected": 2198785
            },
            {
                "name": "地震",
                "latitude": -0.256,
                "longitude": 119.846,
                "start_date": "2018年9月28日",
                "end_date": "2018年9月28日",
                "affected": 2000000
            },
            {
                "name": "地震",
                "latitude": 25.607,
                "longitude": 101.063,
                "start_date": "2000年1月14日",
                "end_date": "2000年1月14日",
                "affected": 1855007
            },
            {
                "name": "地震",
                "latitude": 25.975,
                "longitude": 101.29,
                "start_date": "2003年7月21日",
                "end_date": "2003年7月21日",
                "affected": 1295584
            },
            {
                "name": "地震",
                "latitude": 27.1891,
                "longitude": 103.4086,
                "start_date": "2014年8月3日",
                "end_date": "2014年8月3日",
                "affected": 1120513
            },
            {
                "name": "地震",
                "latitude": 3.295,
                "longitude": 95.982,
                "start_date": "2004年12月26日",
                "end_date": "2004年12月26日",
                "affected": 1019306
            },
            {
                "name": "地震",
                "latitude": 26.241,
                "longitude": 101.889,
                "start_date": "2008年8月30日",
                "end_date": "2008年8月30日",
                "affected": 1000589
            },
            {
                "name": "地震",
                "latitude": 23.419,
                "longitude": 70.232,
                "start_date": "2001年1月26日",
                "end_date": "2001年1月26日",
                "affected": 914292
            },
            {
                "name": "地震",
                "latitude": 27.575,
                "longitude": 103.983,
                "start_date": "2012年9月7日",
                "end_date": "2012年9月7日",
                "affected": 744821
            },
            {
                "name": "地震",
                "latitude": 8.527,
                "longitude": 126.449,
                "start_date": "2023年12月2日",
                "end_date": "2023年12月2日",
                "affected": 721076
            },
            {
                "name": "地震",
                "latitude": 3.295,
                "longitude": 95.982,
                "start_date": "2004年12月26日",
                "end_date": "2004年12月26日",
                "affected": 654512
            },
            {
                "name": "地震",
                "latitude": 29.671,
                "longitude": 115.688,
                "start_date": "2005年11月26日",
                "end_date": "2005年11月26日",
                "affected": 615500
            },
            {
                "name": "地震",
                "latitude": 35.743,
                "longitude": 102.827,
                "start_date": "2023年12月19日",
                "end_date": "2023年12月19日",
                "affected": 600980
            },
            {
                "name": "地震",
                "latitude": 27.73,
                "longitude": 88.155,
                "start_date": "2011年9月18日",
                "end_date": "2011年9月18日",
                "affected": 575200
            },
            {
                "name": "地震",
                "latitude": 34.517,
                "longitude": 61.946,
                "start_date": "2023年10月7日",
                "end_date": "2023年10月7日",
                "affected": 569240
            },
            {
                "name": "地震",
                "latitude": 28.2425,
                "longitude": 99.3502,
                "start_date": "2013年8月31日",
                "end_date": "2013年8月31日",
                "affected": 538050
            },
            {
                "name": "地震",
                "latitude": 3.295,
                "longitude": 95.982,
                "start_date": "2004年12月26日",
                "end_date": "2004年12月26日",
                "affected": 532898
            },
            {
                "name": "地震",
                "latitude": 39.61,
                "longitude": 77.23,
                "start_date": "2003年2月24日",
                "end_date": "2003年2月24日",
                "affected": 517000
            },
            {
                "name": "地震",
                "latitude": -8.287,
                "longitude": 116.452,
                "start_date": "2018年8月5日",
                "end_date": "2018年8月5日",
                "affected": 516927
            },
            {
                "name": "地震",
                "latitude": 17.56,
                "longitude": 120.801,
                "start_date": "2022年7月27日",
                "end_date": "2022年7月27日",
                "affected": 502856
            },
            {
                "name": "地震",
                "latitude": 36.5244,
                "longitude": 70.3676,
                "start_date": "2015年10月25日",
                "end_date": "2015年10月25日",
                "affected": 502590
            },
            {
                "name": "地震",
                "latitude": 27.372,
                "longitude": 103.971,
                "start_date": "2003年11月14日",
                "end_date": "2003年11月14日",
                "affected": 493065
            },
            {
                "name": "地震",
                "latitude": 37.495,
                "longitude": 137.265,
                "start_date": "2024年1月1日",
                "end_date": "2024年1月1日",
                "affected": 492555
            },
            {
                "name": "地震",
                "latitude": -4.438,
                "longitude": 101.367,
                "start_date": "2007年9月12日",
                "end_date": "2007年9月12日",
                "affected": 459567
            },
            {
                "name": "地震",
                "latitude": 43.77,
                "longitude": 119.643,
                "start_date": "2003年8月16日",
                "end_date": "2003年8月16日",
                "affected": 455500
            },
            {
                "name": "地震",
                "latitude": 35.9053,
                "longitude": 82.5864,
                "start_date": "2014年2月12日",
                "end_date": "2014年2月12日",
                "affected": 450000
            },
            {
                "name": "地震",
                "latitude": 25.98,
                "longitude": 99.812,
                "start_date": "2013年3月3日",
                "end_date": "2013年3月3日",
                "affected": 427740
            },
            {
                "name": "地震",
                "latitude": 6.708,
                "longitude": 125.188,
                "start_date": "2019年12月15日",
                "end_date": "2019年12月15日",
                "affected": 394565
            },
            {
                "name": "地震",
                "latitude": 38.297,
                "longitude": 142.373,
                "start_date": "2011年3月11日",
                "end_date": "2011年3月11日",
                "affected": 368820
            },
            {
                "name": "地震",
                "latitude": 33.092,
                "longitude": 69.514,
                "start_date": "2022年6月21日",
                "end_date": "2022年6月21日",
                "affected": 364623
            },
            {
                "name": "地震",
                "latitude": 32.56,
                "longitude": 105.423,
                "start_date": "2008年5月25日",
                "end_date": "2008年5月25日",
                "affected": 351000
            },
            {
                "name": "地震",
                "latitude": -7.782,
                "longitude": 107.297,
                "start_date": "2009年9月2日",
                "end_date": "2009年9月2日",
                "affected": 339792
            },
            {
                "name": "地震",
                "latitude": 9.999,
                "longitude": 123.206,
                "start_date": "2012年2月6日",
                "end_date": "2012年2月6日",
                "affected": 320277
            },
            {
                "name": "地震",
                "latitude": 28.848,
                "longitude": 82.18,
                "start_date": "2023年11月3日",
                "end_date": "2023年11月3日",
                "affected": 300366
            },
            {
                "name": "地震",
                "latitude": 29.513,
                "longitude": 101.129,
                "start_date": "2001年2月23日",
                "end_date": "2001年2月23日",
                "affected": 300109
            },
            {
                "name": "地震",
                "latitude": 32.791,
                "longitude": 130.75,
                "start_date": "2016年4月16日",
                "end_date": "2016年4月16日",
                "affected": 298432
            },
            {
                "name": "地震",
                "latitude": 39.007,
                "longitude": 40.464,
                "start_date": "2003年5月1日",
                "end_date": "2003年5月1日",
                "affected": 290520
            },
            {
                "name": "地震",
                "latitude": 21.996,
                "longitude": 95.926,
                "start_date": "2025年3月28日",
                "end_date": "2025年3月28日",
                "affected": 287614
            },
            {
                "name": "地震",
                "latitude": 38.383,
                "longitude": 100.975,
                "start_date": "2003年10月25日",
                "end_date": "2003年10月25日",
                "affected": 275043
            },
            {
                "name": "地震",
                "latitude": 28.995,
                "longitude": 58.311,
                "start_date": "2003年12月26日",
                "end_date": "2003年12月26日",
                "affected": 267628
            },
            {
                "name": "地震",
                "latitude": 27.995,
                "longitude": 104.138,
                "start_date": "2006年7月22日",
                "end_date": "2006年7月22日",
                "affected": 265106
            },
            {
                "name": "地震",
                "latitude": 38.424,
                "longitude": 44.909,
                "start_date": "2023年1月28日",
                "end_date": "2023年1月28日",
                "affected": 262404
            },
            {
                "name": "地震",
                "latitude": 6.905,
                "longitude": 125.187,
                "start_date": "2019年10月31日",
                "end_date": "2019年10月31日",
                "affected": 260703
            },
            {
                "name": "地震",
                "latitude": 23.3834,
                "longitude": 100.4702,
                "start_date": "2014年10月7日",
                "end_date": "2014年10月7日",
                "affected": 255324
            },
            {
                "name": "地震",
                "latitude": 38.573,
                "longitude": 31.271,
                "start_date": "2002年2月3日",
                "end_date": "2002年2月3日",
                "affected": 252327
            },
            {
                "name": "地震",
                "latitude": -3.45,
                "longitude": 128.347,
                "start_date": "2019年9月26日",
                "end_date": "2019年9月26日",
                "affected": 247418
            },
            {
                "name": "地震",
                "latitude": 28.405,
                "longitude": 104.957,
                "start_date": "2019年6月17日",
                "end_date": "2019年6月17日",
                "affected": 244220
            },
            {
                "name": "地震",
                "latitude": 24.974,
                "longitude": 97.844,
                "start_date": "2014年5月24日",
                "end_date": "2014年5月24日",
                "affected": 225015
            },
            {
                "name": "地震",
                "latitude": 33.193,
                "longitude": 103.855,
                "start_date": "2017年8月8日",
                "end_date": "2017年8月8日",
                "affected": 218325
            },
            {
                "name": "地震",
                "latitude": 34.911,
                "longitude": 45.959,
                "start_date": "2017年11月12日",
                "end_date": "2017年11月12日",
                "affected": 209000
            },
            {
                "name": "地震",
                "latitude": 28.2305,
                "longitude": 84.7314,
                "start_date": "2015年4月25日",
                "end_date": "2015年4月25日",
                "affected": 207883
            },
            {
                "name": "地震",
                "latitude": -4.646,
                "longitude": 102.102,
                "start_date": "2000年6月4日",
                "end_date": "2000年6月4日",
                "affected": 204714
            },
            {
                "name": "地震",
                "latitude": 45.382,
                "longitude": 118.256,
                "start_date": "2004年3月24日",
                "end_date": "2004年3月24日",
                "affected": 190100
            },
            {
                "name": "地震",
                "latitude": 26.951,
                "longitude": 65.5009,
                "start_date": "2013年9月24日",
                "end_date": "2013年9月24日",
                "affected": 185749
            },
            {
                "name": "地震",
                "latitude": 24.9997,
                "longitude": 97.845,
                "start_date": "2014年5月30日",
                "end_date": "2014年5月30日",
                "affected": 184723
            },
            {
                "name": "地震",
                "latitude": 25.826,
                "longitude": 102.194,
                "start_date": "2000年8月21日",
                "end_date": "2000年8月21日",
                "affected": 177611
            },
            {
                "name": "地震",
                "latitude": 27.73,
                "longitude": 88.155,
                "start_date": "2011年9月18日",
                "end_date": "2011年9月18日",
                "affected": 167949
            },
            {
                "name": "地震",
                "latitude": 33.5,
                "longitude": 48.78,
                "start_date": "2006年3月31日",
                "end_date": "2006年3月31日",
                "affected": 161418
            },
            {
                "name": "地震",
                "latitude": 34.539,
                "longitude": 73.588,
                "start_date": "2005年10月8日",
                "end_date": "2005年10月8日",
                "affected": 156622
            },
            {
                "name": "地震",
                "latitude": 43.433,
                "longitude": 84.7,
                "start_date": "2012年6月29日",
                "end_date": "2012年6月29日",
                "affected": 155052
            },
            {
                "name": "地震",
                "latitude": 24.768,
                "longitude": 99.061,
                "start_date": "2001年4月12日",
                "end_date": "2001年4月12日",
                "affected": 150190
            },
            {
                "name": "地震",
                "latitude": 17.662,
                "longitude": 120.823,
                "start_date": "2022年10月25日",
                "end_date": "2022年10月25日",
                "affected": 147422
            },
            {
                "name": "地震",
                "latitude": -5.867,
                "longitude": 112.362,
                "start_date": "2024年3月22日",
                "end_date": "2024年3月22日",
                "affected": 144522
            },
            {
                "name": "地震",
                "latitude": 43.648,
                "longitude": 82.437,
                "start_date": "2011年11月1日",
                "end_date": "2011年11月1日",
                "affected": 143000
            },
            {
                "name": "地震",
                "latitude": 35.414,
                "longitude": 74.515,
                "start_date": "2002年11月20日",
                "end_date": "2002年11月20日",
                "affected": 140782
            },
            {
                "name": "地震",
                "latitude": -0.488,
                "longitude": 100.53,
                "start_date": "2007年3月6日",
                "end_date": "2007年3月6日",
                "affected": 137660
            },
            {
                "name": "地震",
                "latitude": 29.726,
                "longitude": 102.279,
                "start_date": "2022年9月5日",
                "end_date": "2022年9月5日",
                "affected": 130400
            },
            {
                "name": "地震",
                "latitude": 33.106,
                "longitude": 73.766,
                "start_date": "2019年9月24日",
                "end_date": "2019年9月24日",
                "affected": 130398
            },
            {
                "name": "地震",
                "latitude": 34.512,
                "longitude": 104.262,
                "start_date": "2013年7月22日",
                "end_date": "2013年7月22日",
                "affected": 123887
            },
            {
                "name": "地震",
                "latitude": 32.788,
                "longitude": 130.7,
                "start_date": "2016年4月14日",
                "end_date": "2016年4月14日",
                "affected": 120800
            },
            {
                "name": "地震",
                "latitude": 27.266,
                "longitude": 103.873,
                "start_date": "2004年8月10日",
                "end_date": "2004年8月10日",
                "affected": 120600
            },
            {
                "name": "地震",
                "latitude": 33.165,
                "longitude": 96.548,
                "start_date": "2010年4月14日",
                "end_date": "2010年4月14日",
                "affected": 112000
            },
            {
                "name": "地震",
                "latitude": 35.626,
                "longitude": 49.047,
                "start_date": "2002年6月22日",
                "end_date": "2002年6月22日",
                "affected": 111300
            },
            {
                "name": "地震",
                "latitude": 2.085,
                "longitude": 97.108,
                "start_date": "2005年3月28日",
                "end_date": "2005年3月28日",
                "affected": 105313
            },
            {
                "name": "地震",
                "latitude": -8.274,
                "longitude": 116.491,
                "start_date": "2018年7月29日",
                "end_date": "2018年7月29日",
                "affected": 102852
            },
            {
                "name": "地震",
                "latitude": -2.976,
                "longitude": 118.901,
                "start_date": "2021年1月15日",
                "end_date": "2021年1月15日",
                "affected": 100653
            },
            {
                "name": "地震",
                "latitude": 25.073,
                "longitude": 99.169,
                "start_date": "2004年10月18日",
                "end_date": "2004年10月18日",
                "affected": 100012
            },
            {
                "name": "地震",
                "latitude": 5.583,
                "longitude": 125.022,
                "start_date": "2023年11月17日",
                "end_date": "2023年11月17日",
                "affected": 99578
            },
            {
                "name": "地震",
                "latitude": 30.754,
                "longitude": 56.816,
                "start_date": "2005年2月22日",
                "end_date": "2005年2月22日",
                "affected": 94766
            },
            {
                "name": "地震",
                "latitude": 36.5244,
                "longitude": 70.3676,
                "start_date": "2015年10月26日",
                "end_date": "2015年10月26日",
                "affected": 92725
            },
            {
                "name": "地震",
                "latitude": 36.062,
                "longitude": 69.315,
                "start_date": "2002年3月25日",
                "end_date": "2002年3月25日",
                "affected": 91228
            },
            {
                "name": "地震",
                "latitude": 31.066,
                "longitude": 110.412,
                "start_date": "2013年12月16日",
                "end_date": "2013年12月16日",
                "affected": 90500
            },
            {
                "name": "地震",
                "latitude": 5.281,
                "longitude": 96.108,
                "start_date": "2016年12月7日",
                "end_date": "2016年12月7日",
                "affected": 86018
            },
            {
                "name": "地震",
                "latitude": -8.152,
                "longitude": 124.868,
                "start_date": "2004年11月11日",
                "end_date": "2004年11月11日",
                "affected": 83381
            },
            {
                "name": "地震",
                "latitude": 30.3398,
                "longitude": 101.7374,
                "start_date": "2014年11月22日",
                "end_date": "2014年11月22日",
                "affected": 82355
            },
            {
                "name": "地震",
                "latitude": 25.953,
                "longitude": 99.782,
                "start_date": "2013年4月17日",
                "end_date": "2013年4月17日",
                "affected": 80555
            },
            {
                "name": "地震",
                "latitude": 30.639,
                "longitude": 67.351,
                "start_date": "2008年10月28日",
                "end_date": "2008年10月28日",
                "affected": 75320
            },
            {
                "name": "地震",
                "latitude": 28.174,
                "longitude": 103.619,
                "start_date": "2014年4月4日",
                "end_date": "2014年4月4日",
                "affected": 75021
            },
            {
                "name": "地震",
                "latitude": 6.033,
                "longitude": 124.249,
                "start_date": "2002年3月5日",
                "end_date": "2002年3月5日",
                "affected": 73451
            },
            {
                "name": "洪水",
                "latitude": 9.88,
                "longitude": 78.47,
                "start_date": "2010年11月15日",
                "end_date": "2010年12月7日",
                "affected": 203
            },
            {
                "name": "洪水",
                "latitude": 16.65,
                "longitude": 81.38,
                "start_date": "2008年9月5日",
                "end_date": "2008年9月11日",
                "affected": 74
            },
            {
                "name": "洪水",
                "latitude": 27.068,
                "longitude": 93.95,
                "start_date": "2016年6月25日",
                "end_date": "2016年7月1日",
                "affected": 61
            },
            {
                "name": "洪水",
                "latitude": 11.06,
                "longitude": 104.68,
                "start_date": "2006年8月10日",
                "end_date": "2006年11月1日",
                "affected": 60
            },
            {
                "name": "洪水",
                "latitude": 15.08,
                "longitude": 45.73,
                "start_date": "2007年8月1日",
                "end_date": "2007年8月27日",
                "affected": 50
            },
            {
                "name": "洪水",
                "latitude": 36.03,
                "longitude": 72.08,
                "start_date": "2010年6月22日",
                "end_date": "2010年6月24日",
                "affected": 46
            },
            {
                "name": "洪水",
                "latitude": 37.704,
                "longitude": 46.169,
                "start_date": "2017年4月15日",
                "end_date": "2017年4月16日",
                "affected": 42
            },
            {
                "name": "洪水",
                "latitude": 18.73,
                "longitude": 75.23,
                "start_date": "2006年5月31日",
                "end_date": "2006年6月4日",
                "affected": 41
            },
            {
                "name": "洪水",
                "latitude": 7.44,
                "longitude": 99.65,
                "start_date": "2007年4月14日",
                "end_date": "2007年4月15日",
                "affected": 38
            },
            {
                "name": "洪水",
                "latitude": 37.01,
                "longitude": 70.73,
                "start_date": "2007年4月23日",
                "end_date": "2007年5月4日",
                "affected": 36
            },
            {
                "name": "洪水",
                "latitude": 24.66,
                "longitude": 102.18,
                "start_date": "2006年7月20日",
                "end_date": "2006年7月21日",
                "affected": 35
            },
            {
                "name": "洪水",
                "latitude": 19.17,
                "longitude": 83.65,
                "start_date": "2006年7月3日",
                "end_date": "2006年7月8日",
                "affected": 33
            },
            {
                "name": "洪水",
                "latitude": 28.0,
                "longitude": 85.71,
                "start_date": "2009年7月26日",
                "end_date": "2009年7月28日",
                "affected": 30
            },
            {
                "name": "洪水",
                "latitude": 35.95,
                "longitude": 74.34,
                "start_date": "2007年8月12日",
                "end_date": "2007年8月14日",
                "affected": 22
            },
            {
                "name": "洪水",
                "latitude": 17.43,
                "longitude": 82.81,
                "start_date": "2006年4月15日",
                "end_date": "2006年4月18日",
                "affected": 20
            },
            {
                "name": "洪水",
                "latitude": 32.89,
                "longitude": 73.88,
                "start_date": "2006年8月31日",
                "end_date": "2006年9月11日",
                "affected": 20
            },
            {
                "name": "洪水",
                "latitude": 13.36,
                "longitude": 123.38,
                "start_date": "2007年10月27日",
                "end_date": "2007年11月1日",
                "affected": 20
            },
            {
                "name": "洪水",
                "latitude": 37.0528,
                "longitude": 70.0,
                "start_date": "2012年5月12日",
                "end_date": "2012年5月16日",
                "affected": 20
            },
            {
                "name": "洪水",
                "latitude": 20.5946,
                "longitude": 51.01,
                "start_date": "2012年4月14日",
                "end_date": "2012年4月18日",
                "affected": 19
            },
            {
                "name": "洪水",
                "latitude": 22.68,
                "longitude": 70.93,
                "start_date": "2007年8月8日",
                "end_date": "2007年8月15日",
                "affected": 16
            },
            {
                "name": "洪水",
                "latitude": 34.7,
                "longitude": 102.68,
                "start_date": "2006年8月30日",
                "end_date": "2006年8月31日",
                "affected": 15
            },
            {
                "name": "洪水",
                "latitude": 16.73,
                "longitude": 47.92,
                "start_date": "2010年7月10日",
                "end_date": "2010年7月15日",
                "affected": 15
            },
            {
                "name": "洪水",
                "latitude": 28.9081,
                "longitude": 82.28,
                "start_date": "2011年7月2日",
                "end_date": "2011年7月19日",
                "affected": 15
            },
            {
                "name": "火山运动",
                "latitude": -7.93,
                "longitude": 112.308,
                "start_date": "2014年2月14日",
                "end_date": "2014年2月14日",
                "affected": 83158
            },
            {
                "name": "火山运动",
                "latitude": 13.257,
                "longitude": 123.685,
                "start_date": "2000年2月24日",
                "end_date": "2000年3月9日",
                "affected": 68426
            },
            {
                "name": "火山运动",
                "latitude": 13.257,
                "longitude": 123.685,
                "start_date": "2009年12月14日",
                "end_date": "2009年12月20日",
                "affected": 47137
            },
            {
                "name": "火山运动",
                "latitude": 13.257,
                "longitude": 123.685,
                "start_date": "2006年8月13日",
                "end_date": "2006年8月13日",
                "affected": 43849
            },
            {
                "name": "火山运动",
                "latitude": 12.77,
                "longitude": 124.05,
                "start_date": "2011年2月21日",
                "end_date": "2011年2月21日",
                "affected": 32616
            },
            {
                "name": "火山运动",
                "latitude": 3.17,
                "longitude": 98.392,
                "start_date": "2014年2月1日",
                "end_date": "2014年2月1日",
                "affected": 32002
            },
            {
                "name": "火山运动",
                "latitude": 3.17,
                "longitude": 98.392,
                "start_date": "未知",
                "end_date": "未知",
                "affected": 29727
            },
            {
                "name": "火山运动",
                "latitude": 13.257,
                "longitude": 123.685,
                "start_date": "2001年5月24日",
                "end_date": "2001年5月24日",
                "affected": 25576
            },
            {
                "name": "火山运动",
                "latitude": -7.93,
                "longitude": 112.308,
                "start_date": "2007年10月16日",
                "end_date": "2007年10月18日",
                "affected": 22154
            },
            {
                "name": "火山运动",
                "latitude": 3.17,
                "longitude": 98.392,
                "start_date": "2010年8月29日",
                "end_date": "2010年9月7日",
                "affected": 15060
            },
            {
                "name": "火山运动",
                "latitude": 12.77,
                "longitude": 124.05,
                "start_date": "2010年11月9日",
                "end_date": "2010年11月9日",
                "affected": 14161
            },
            {
                "name": "火山运动",
                "latitude": 12.77,
                "longitude": 124.05,
                "start_date": "2007年7月31日",
                "end_date": "2007年7月31日",
                "affected": 14036
            },
            {
                "name": "火山运动",
                "latitude": 34.92,
                "longitude": 139.12,
                "start_date": "2000年3月31日",
                "end_date": "2000年4月13日",
                "affected": 12400
            },
            {
                "name": "火山运动",
                "latitude": 1.358333,
                "longitude": 124.79,
                "start_date": "2011年7月11日",
                "end_date": "2011年7月17日",
                "affected": 6000
            },
            {
                "name": "火山运动",
                "latitude": 0.8,
                "longitude": 127.33,
                "start_date": "2011年12月4日",
                "end_date": "2011年12月27日",
                "affected": 2373
            },
            {
                "name": "火山运动",
                "latitude": 14.002,
                "longitude": 120.993,
                "start_date": "2011年3月17日",
                "end_date": "2011年4月18日",
                "affected": 1315
            },
            {
                "name": "火山运动",
                "latitude": 13.257,
                "longitude": 123.685,
                "start_date": "2014年9月16日",
                "end_date": "2014年12月3日",
                "affected": 60545
            },
            {
                "name": "火山运动",
                "latitude": 35.893,
                "longitude": 137.48,
                "start_date": "2014年9月27日",
                "end_date": "2014年9月30日",
                "affected": 69
            },
            {
                "name": "风暴",
                "latitude": 24.0,
                "longitude": 112.11,
                "start_date": "2006年7月16日",
                "end_date": "2006年7月19日",
                "affected": 29622000
            },
            {
                "name": "风暴",
                "latitude": 21.11,
                "longitude": 110.11,
                "start_date": "2006年8月3日",
                "end_date": "2006年8月6日",
                "affected": 10000000
            },
            {
                "name": "风暴",
                "latitude": 22.61,
                "longitude": 90.15,
                "start_date": "2007年11月15日",
                "end_date": "2007年11月19日",
                "affected": 8978541
            },
            {
                "name": "风暴",
                "latitude": 22.7696,
                "longitude": 113.69,
                "start_date": "2013年8月15日",
                "end_date": "2013年8月21日",
                "affected": 8000000
            },
            {
                "name": "风暴",
                "latitude": 26.39,
                "longitude": 117.28,
                "start_date": "2006年7月24日",
                "end_date": "2006年7月28日",
                "affected": 6531000
            },
            {
                "name": "风暴",
                "latitude": 13.16,
                "longitude": 122.6,
                "start_date": "2008年6月21日",
                "end_date": "2008年6月23日",
                "affected": 4785460
            },
            {
                "name": "风暴",
                "latitude": 17.57,
                "longitude": 121.42,
                "start_date": "2009年9月29日",
                "end_date": "2009年10月10日",
                "affected": 4478491
            },
            {
                "name": "风暴",
                "latitude": 22.16,
                "longitude": 89.09,
                "start_date": "2009年5月25日",
                "end_date": "2009年5月26日",
                "affected": 3935341
            },
            {
                "name": "风暴",
                "latitude": 16.68,
                "longitude": 107.21,
                "start_date": "2006年9月27日",
                "end_date": "2006年10月6日",
                "affected": 3842406
            },
            {
                "name": "风暴",
                "latitude": 25.97,
                "longitude": 118.77,
                "start_date": "2006年5月18日",
                "end_date": "2006年5月22日",
                "affected": 3150000
            },
            {
                "name": "风暴",
                "latitude": 16.691,
                "longitude": 121.24,
                "start_date": "2015年10月14日",
                "end_date": "2015年10月20日",
                "affected": 2898590
            },
            {
                "name": "风暴",
                "latitude": 10.33,
                "longitude": 106.74,
                "start_date": "2006年11月30日",
                "end_date": "2006年12月8日",
                "affected": 2562517
            },
            {
                "name": "风暴",
                "latitude": 25.26,
                "longitude": 67.9,
                "start_date": "2007年6月26日",
                "end_date": "2007年7月6日",
                "affected": 1650000
            },
            {
                "name": "风暴",
                "latitude": 16.68,
                "longitude": 107.21,
                "start_date": "2006年9月27日",
                "end_date": "2006年10月6日",
                "affected": 1467925
            },
            {
                "name": "风暴",
                "latitude": 10.33,
                "longitude": 106.74,
                "start_date": "2006年11月30日",
                "end_date": "2006年12月8日",
                "affected": 1226360
            },
            {
                "name": "风暴",
                "latitude": 8.526,
                "longitude": 124.88,
                "start_date": "2011年12月15日",
                "end_date": "2011年12月18日",
                "affected": 1150300
            },
            {
                "name": "风暴",
                "latitude": 17.07,
                "longitude": 106.9,
                "start_date": "2007年9月29日",
                "end_date": "2007年10月12日",
                "affected": 685430
            },
            {
                "name": "风暴",
                "latitude": 17.1,
                "longitude": 121.47,
                "start_date": "2010年7月12日",
                "end_date": "2010年7月15日",
                "affected": 585474
            },
            {
                "name": "风暴",
                "latitude": 15.86,
                "longitude": 120.74,
                "start_date": "2006年6月30日",
                "end_date": "2006年8月2日",
                "affected": 476027
            },
            {
                "name": "风暴",
                "latitude": 17.08,
                "longitude": 122.01,
                "start_date": "2007年11月25日",
                "end_date": "2007年12月2日",
                "affected": 443115
            },
            {
                "name": "风暴",
                "latitude": 27.0,
                "longitude": 119.91,
                "start_date": "2007年8月17日",
                "end_date": "2007年8月24日",
                "affected": 380000
            },
            {
                "name": "风暴",
                "latitude": 23.542,
                "longitude": 112.3,
                "start_date": "2008年6月24日",
                "end_date": "2008年6月27日",
                "affected": 340000
            },
            {
                "name": "风暴",
                "latitude": 17.02,
                "longitude": 121.82,
                "start_date": "2006年10月30日",
                "end_date": "2006年11月1日",
                "affected": 283021
            },
            {
                "name": "风暴",
                "latitude": 26.39,
                "longitude": 117.39,
                "start_date": "2006年7月24日",
                "end_date": "2006年7月28日",
                "affected": 200355
            },
            {
                "name": "风暴",
                "latitude": 19.73,
                "longitude": 83.75,
                "start_date": "2006年9月18日",
                "end_date": "2006年10月5日",
                "affected": 150300
            },
            {
                "name": "风暴",
                "latitude": 32.56,
                "longitude": 114.41,
                "start_date": "2008年7月28日",
                "end_date": "2008年8月8日",
                "affected": 93006
            },
            {
                "name": "风暴",
                "latitude": 11.82,
                "longitude": 78.08,
                "start_date": "2012年11月4日",
                "end_date": "2012年11月8日",
                "affected": 70000
            },
            {
                "name": "风暴",
                "latitude": 18.37,
                "longitude": 94.95,
                "start_date": "2006年4月29日",
                "end_date": "2006年5月5日",
                "affected": 60106
            },
            {
                "name": "风暴",
                "latitude": 21.9,
                "longitude": 104.59,
                "start_date": "2008年9月25日",
                "end_date": "2008年9月28日",
                "affected": 58511
            },
            {
                "name": "风暴",
                "latitude": 22.05,
                "longitude": 105.21,
                "start_date": "2008年8月8日",
                "end_date": "2008年8月11日",
                "affected": 57630
            },
            {
                "name": "风暴",
                "latitude": 24.0,
                "longitude": 112.11,
                "start_date": "2006年7月11日",
                "end_date": "2006年7月17日",
                "affected": 51680
            },
            {
                "name": "风暴",
                "latitude": 38.19,
                "longitude": 126.24,
                "start_date": "2012年8月28日",
                "end_date": "2012年8月30日",
                "affected": 44461
            },
            {
                "name": "风暴",
                "latitude": 22.33,
                "longitude": 113.15,
                "start_date": "2008年8月8日",
                "end_date": "2008年8月11日",
                "affected": 42000
            },
            {
                "name": "风暴",
                "latitude": 31.69,
                "longitude": 130.9,
                "start_date": "2007年7月13日",
                "end_date": "2007年7月16日",
                "affected": 40012
            },
            {
                "name": "风暴",
                "latitude": 8.796,
                "longitude": 124.83,
                "start_date": "2007年11月18日",
                "end_date": "2007年11月23日",
                "affected": 35333
            },
            {
                "name": "风暴",
                "latitude": 17.57,
                "longitude": 121.76,
                "start_date": "2007年11月4日",
                "end_date": "2007年11月6日",
                "affected": 33884
            },
            {
                "name": "风暴",
                "latitude": 38.57,
                "longitude": 125.83,
                "start_date": "2007年9月17日",
                "end_date": "2007年9月25日",
                "affected": 30000
            },
            {
                "name": "风暴",
                "latitude": 21.11,
                "longitude": 110.11,
                "start_date": "2006年8月2日",
                "end_date": "2006年8月6日",
                "affected": 15000
            },
            {
                "name": "风暴",
                "latitude": 22.11,
                "longitude": 105.95,
                "start_date": "2010年7月23日",
                "end_date": "2010年7月25日",
                "affected": 12400
            },
            {
                "name": "风暴",
                "latitude": 19.73,
                "longitude": 83.75,
                "start_date": "2006年9月18日",
                "end_date": "2006年10月5日",
                "affected": 9135
            },
            {
                "name": "风暴",
                "latitude": 15.7,
                "longitude": 107.71,
                "start_date": "2008年11月17日",
                "end_date": "2008年11月20日",
                "affected": 8828
            },
            {
                "name": "风暴",
                "latitude": 25.8633,
                "longitude": 118.14,
                "start_date": "2013年7月13日",
                "end_date": "2013年7月15日",
                "affected": 3000
            },
            {
                "name": "风暴",
                "latitude": 24.0,
                "longitude": 112.11,
                "start_date": "2006年7月11日",
                "end_date": "2006年7月19日",
                "affected": 2000
            },
            {
                "name": "风暴",
                "latitude": 17.07,
                "longitude": 106.9,
                "start_date": "2007年9月29日",
                "end_date": "2007年10月12日",
                "affected": 2000
            },
            {
                "name": "风暴",
                "latitude": 27.0,
                "longitude": 119.91,
                "start_date": "2007年8月17日",
                "end_date": "2007年8月24日",
                "affected": 1812
            },
            {
                "name": "风暴",
                "latitude": 38.57,
                "longitude": 125.83,
                "start_date": "2007年9月17日",
                "end_date": "2007年9月25日",
                "affected": 1649
            },
            {
                "name": "风暴",
                "latitude": 33.2,
                "longitude": 134.0,
                "start_date": "2017年8月5日",
                "end_date": "2017年8月7日",
                "affected": 1389
            },
            {
                "name": "风暴",
                "latitude": 23.76,
                "longitude": 121.02,
                "start_date": "2007年10月6日",
                "end_date": "2007年10月10日",
                "affected": 1067
            },
            {
                "name": "风暴",
                "latitude": 26.39,
                "longitude": 117.28,
                "start_date": "2006年7月24日",
                "end_date": "2006年7月28日",
                "affected": 800
            },
            {
                "name": "风暴",
                "latitude": 34.78,
                "longitude": 126.59,
                "start_date": "2007年9月16日",
                "end_date": "2007年9月19日",
                "affected": 602
            },
            {
                "name": "风暴",
                "latitude": 22.429,
                "longitude": 120.7,
                "start_date": "2010年9月18日",
                "end_date": "2010年9月20日",
                "affected": 100
            },
            {
                "name": "风暴",
                "latitude": 22.94,
                "longitude": 120.79,
                "start_date": "2008年7月18日",
                "end_date": "2008年7月19日",
                "affected": 8
            },
            {
                "name": "风暴",
                "latitude": 20.691,
                "longitude": 105.183,
                "start_date": "2020年3月2日",
                "end_date": "2020年3月10日",
                "affected": 4652
            }

        ];

        const shapeMap = {
            "地震": "circle",
            "洪水": "square",
            "火山运动": "hexagon",
            "风暴": "diamond"
        };

        // 年份提取和排序工具
        function getYear(str) {
            let y = str.match(/(\d{4})年/);
            if (y) return y[1];
            y = str.match(/^(\d{4})/);
            if (y) return y[1];
            return null;
        }
        function getYearCounts(data) {
            let yearCounts = {};
            data.forEach(item => {
                let y = getYear(item.start_date);
                if (y) yearCounts[y] = (yearCounts[y] || 0) + 1;
            });
            return yearCounts;
        }
        function generateYearRangeSlider() {
            const years = data.map(d => parseInt(getYear(d.start_date))).filter(y => !isNaN(y));
            const min = Math.min(...years);
            const max = Math.max(...years);

            const startSlider = document.getElementById("yearStart");
            const endSlider = document.getElementById("yearEnd");
            const display = document.getElementById("yearRangeDisplay");

            startSlider.min = endSlider.min = min;
            startSlider.max = endSlider.max = max;
            startSlider.value = min;
            endSlider.value = max;

            function updateDisplayAndMap() {
                let start = parseInt(startSlider.value);
                let end = parseInt(endSlider.value);
                if (start > end) [start, end] = [end, start]; // 交换
                display.textContent = `${start} - ${end}`;
                updateMarkers(document.getElementById("disasterType").value, start, end);
            }

            startSlider.addEventListener("input", updateDisplayAndMap);
            endSlider.addEventListener("input", updateDisplayAndMap);

            updateDisplayAndMap(); // 初始化
        }



        // 地图与标记
        const map = L.map('map').setView([30, 100], 4);
        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
            attribution: '&copy; OpenStreetMap contributors'
        }).addTo(map);
        let markers = [];
        function updateMarkers(selectedType, startYear, endYear) {
            markers.forEach(marker => map.removeLayer(marker));
            markers = [];
            data.forEach(item => {
                let show = true;
                if (selectedType !== "全部" && item.name !== selectedType) show = false;
                let year = parseInt(getYear(item.start_date));
                if (isNaN(year) || year < startYear || year > endYear) show = false;

                if (show) {
                    const shapeClass = shapeMap[item.name] || "circle";
                    const size = Math.sqrt(item.affected) / 300 + 10;
                    const icon = L.divIcon({
                        className: '',
                        html: `<div class="shape ${shapeClass}" style="width:${size}px;height:${size}px;"></div>`,
                        iconSize: [size, size],
                        iconAnchor: [size / 2, size / 2]
                    });
                    const marker = L.marker([item.latitude, item.longitude], { icon }).addTo(map)
                        .bindPopup(`<strong>${item.name}</strong><br>开始时间：${item.start_date}<br>结束时间：${item.end_date}<br>总影响人数：${item.affected.toLocaleString()}`);
                    markers.push(marker);
                }
            });
        }

        generateYearRangeSlider();
        updateMarkers("全部", 2000, 2025); 

        document.getElementById("disasterType").addEventListener("change", function () {
            const startYear = parseInt(document.getElementById("yearStart").value);
            const endYear = parseInt(document.getElementById("yearEnd").value);
            updateMarkers(this.value, startYear, endYear);
        });

        document.getElementById("yearStart").addEventListener("input", function () {
            const selectedType = document.getElementById("disasterType").value;
            const startYear = parseInt(document.getElementById("yearStart").value);
            const endYear = parseInt(document.getElementById("yearEnd").value);
            updateMarkers(selectedType, startYear, endYear);
        });

        document.getElementById("yearEnd").addEventListener("input", function () {
            const selectedType = document.getElementById("disasterType").value;
            const startYear = parseInt(document.getElementById("yearStart").value);
            const endYear = parseInt(document.getElementById("yearEnd").value);
            updateMarkers(selectedType, startYear, endYear);
        });
    </script>
</body>
</html>
